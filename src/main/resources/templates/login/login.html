<!-- src/main/resources/templates/login/login.html -->
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" th:lang="${#locale.language}">
<head>
  <meta charset="utf-8" />
  <title th:text="#{login.title}">Login</title>
  <link rel="stylesheet" th:href="@{/css/index.css}">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400..900;1,400..900&display=swap" rel="stylesheet">
</head>
<body>
  <div th:replace="fragments/header_login :: header_login"></div>

  <div class="carousel" aria-live="polite">
    <div class="carousel-image" aria-hidden="true"></div>
    <div class="carousel-black-overlay"></div>
    <h1 class="title" th:text="#{app.title}">CABA PRO</h1>
  </div>

  <div class="login-blur-bg">
    <div class="login-container">
      <form th:action="@{/login}" method="post" class="login-form">
        <h2 th:text="#{login.heading}">Iniciar Sesión</h2>

        <label for="username" th:text="#{login.username.label}">Usuario</label>
        <input type="text"
               id="username"
               name="username"
               th:placeholder="#{login.username.placeholder}"
               placeholder="Ingresa tu usuario"
               required>

        <label for="password" th:text="#{login.password.label}">Contraseña</label>
        <input type="password"
               id="password"
               name="password"
               th:placeholder="#{login.password.placeholder}"
               placeholder="Ingresa tu contraseña"
               required>

        <button type="submit" class="btn" th:text="#{login.submit}">Entrar</button>

        <div th:if="${param.error}" class="message error" th:text="#{login.error}">
          Credenciales inválidas.
        </div>

        <div th:if="${param.logout}" class="message success" th:text="#{login.logout}">
          Has cerrado sesión correctamente.
        </div>

        <div class="register-link">
          <a th:href="@{/registro}" class="link-white" th:text="#{login.register.link}">
            Crear cuenta
          </a>
        </div>
      </form>
    </div>
  </div>

  <footer>
    <p th:text="#{footer.copy(${#temporals.createNow().year})}">© 2025 CABA PRO</p>
  </footer>

  <script>
    (function() {
      const images = [
        '/Imageneshome/estadio.png',
        '/Imageneshome/torneo.png',
        '/Imageneshome/cancha.png',
        '/Imageneshome/encesta.png'
      ];
      const fadeDuration = 1500;
      const imageVisible = 8000;
      const blackFull = 3000;

      const imageEl = document.querySelector('.carousel-image');
      const overlay = document.querySelector('.carousel-black-overlay');
      if (!imageEl || !overlay) return;

      overlay.style.transition = `opacity ${fadeDuration}ms cubic-bezier(0.22, 0.8, 0.24, 1)`;
      imageEl.style.transition = `opacity ${fadeDuration}ms ease-in-out`;

      images.forEach(src => { const img = new Image(); img.src = src; });

      let current = 0;

      function setBackground(idx) { imageEl.style.backgroundImage = "url('" + images[idx] + "')"; }

      function showImage(index) {
        setBackground(index);
        void overlay.offsetWidth;
        overlay.style.opacity = '0';
        setTimeout(() => {
          overlay.style.opacity = '1';
          setTimeout(() => {
            const next = (index + 1) % images.length;
            setBackground(next);
            setTimeout(() => { showImage(next); }, blackFull);
          }, fadeDuration);
        }, fadeDuration + imageVisible);
      }

      overlay.style.opacity = '1';
      setBackground(current);
      setTimeout(() => { showImage(current); }, 400);

      document.addEventListener('visibilitychange', function() {
        if (document.hidden) { overlay.style.opacity = '1'; }
        else { setTimeout(() => { showImage(current); }, 300); }
      });
    })();
  </script>
</body>
</html>