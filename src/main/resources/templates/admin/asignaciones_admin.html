<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="es">
<head>
  <meta charset="UTF-8">
  <title th:text="#{admin.assignments.title}">Gestión de Asignaciones</title>
  <link rel="stylesheet" th:href="@{/css/sidebar.css}">
  <link rel="stylesheet" th:href="@{/css/asignaciones.css}">
  <link rel="stylesheet" th:href="@{/css/main.css}">
</head>
<body>
<div th:replace="~{fragments/header_admin :: header_admin}"></div>

<div class="main-content">
  <h1 th:text="#{admin.assignments.heading}">Estado de Asignaciones de Árbitros</h1>

  <div th:unless="${#lists.isEmpty(asignaciones)}">
    <table class="table table-striped">
      <thead class="thead-dark">
      <tr>
        <th th:text="#{admin.assignments.col.match}">Partido</th>
        <th th:text="#{admin.assignments.col.date}">Fecha</th>
        <th th:text="#{admin.assignments.col.time}">Hora</th>
        <th th:text="#{admin.assignments.col.mainRef}">Árbitro Principal</th>
        <th th:text="#{admin.assignments.col.status}">Estado</th>
        <th th:text="#{admin.assignments.col.assistantRef}">Árbitro Auxiliar</th>
        <th th:text="#{admin.assignments.col.status}">Estado</th>
        <th th:text="#{admin.assignments.col.secondAssistantRef}">Segundo Auxiliar</th>
        <th th:text="#{admin.assignments.col.status}">Estado</th>
      </tr>
      </thead>
      <tbody>
      <tr th:each="asignacion : ${asignaciones}">
        <td th:text="${asignacion.partido.nombre}"></td>
        <td th:text="${asignacion.partido.fecha}"></td>
        <td th:text="${asignacion.partido.hora}"></td>

        <th:block th:with="
          principal=${#lists.isEmpty(asignacion.asignaciones.?[rolPartido == 'ARBITRO_PRINCIPAL']) ? null : asignacion.asignaciones.?[rolPartido == 'ARBITRO_PRINCIPAL'][0]},
          auxiliar=${#lists.isEmpty(asignacion.asignaciones.?[rolPartido == 'AUXILIAR']) ? null : asignacion.asignaciones.?[rolPartido == 'AUXILIAR'][0]},
          segundoAux=${#lists.isEmpty(asignacion.asignaciones.?[rolPartido == 'SEGUNDO_AUXILIAR']) ? null : asignacion.asignaciones.?[rolPartido == 'SEGUNDO_AUXILIAR'][0]}
        ">

          <!-- Árbitro Principal -->
          <td>
            <span th:if="${principal != null and principal.arbitro != null and principal.arbitro.usuario != null}"
                  th:text="${principal.arbitro.usuario.nombre + ' ' + principal.arbitro.usuario.apellido}"></span>
            <span th:unless="${principal != null and principal.arbitro != null and principal.arbitro.usuario != null}">-</span>
          </td>
          <td class="status-cell">
            <span th:if="${principal}"
                  th:class="${principal.estado == 'PENDIENTE'} ? 'badge bg-warning' : (${principal.estado == 'ACEPTADO'} ? 'badge bg-success' : 'badge bg-danger')"
                  th:text="${#messages.msgOrNull('status.' + principal.estado) ?: principal.estado}">
              Estado
            </span>
            <span th:unless="${principal}">-</span>
            <a class="btn-sm btn-info"
               th:if="${principal != null and principal.estado == 'RECHAZADO'}"
               th:href="@{/admin/partido/editar/{id}(id=${asignacion.partido.id})}"
               th:text="#{admin.assignments.reassign}">
              Reasignar
            </a>
          </td>

          <!-- Árbitro Auxiliar -->
          <td>
            <span th:if="${auxiliar != null and auxiliar.arbitro != null and auxiliar.arbitro.usuario != null}"
                  th:text="${auxiliar.arbitro.usuario.nombre + ' ' + auxiliar.arbitro.usuario.apellido}"></span>
            <span th:unless="${auxiliar != null and auxiliar.arbitro != null and auxiliar.arbitro.usuario != null}">-</span>
          </td>
          <td class="status-cell">
            <span th:if="${auxiliar}"
                  th:class="${auxiliar.estado == 'PENDIENTE'} ? 'badge bg-warning' : (${auxiliar.estado == 'ACEPTADO'} ? 'badge bg-success' : 'badge bg-danger')"
                  th:text="${#messages.msgOrNull('status.' + auxiliar.estado) ?: auxiliar.estado}">
            </span>
            <span th:unless="${auxiliar}">-</span>
            <a class="btn-sm btn-info"
               th:if="${auxiliar != null and auxiliar.estado == 'RECHAZADO'}"
               th:href="@{/admin/partido/editar/{id}(id=${asignacion.partido.id})}"
               th:text="#{admin.assignments.reassign}">
              Reasignar
            </a>
          </td>

          <!-- Segundo Auxiliar -->
          <td>
            <span th:if="${segundoAux != null and segundoAux.arbitro != null and segundoAux.arbitro.usuario != null}"
                  th:text="${segundoAux.arbitro.usuario.nombre + ' ' + segundoAux.arbitro.usuario.apellido}"></span>
            <span th:unless="${segundoAux != null and segundoAux.arbitro != null and segundoAux.arbitro.usuario != null}">-</span>
          </td>
          <td class="status-cell">
            <span th:if="${segundoAux}"
                  th:class="${segundoAux.estado == 'PENDIENTE'} ? 'badge bg-warning' : (${segundoAux.estado == 'ACEPTADO'} ? 'badge bg-success' : 'badge bg-danger')"
                  th:text="${#messages.msgOrNull('status.' + segundoAux.estado) ?: segundoAux.estado}">
            </span>
            <span th:unless="${segundoAux}">-</span>
            <a class="btn-sm btn-info"
               th:if="${segundoAux != null and segundoAux.estado == 'RECHAZADO'}"
               th:href="@{/admin/partido/editar/{id}(id=${asignacion.partido.id})}"
               th:text="#{admin.assignments.reassign}">
              Reasignar
            </a>
          </td>
        </th:block>
      </tr>
      </tbody>
    </table>
  </div>

  <div th:if="${#lists.isEmpty(asignaciones)}" class="alert alert-info">
    <p class="h4" th:text="#{admin.assignments.empty}">No hay partidos con asignaciones registrados.</p>
  </div>
</div>
</body>
</html>